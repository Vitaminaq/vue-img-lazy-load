var t=function(t){this.init(t)};t.prototype.init=function(t){this.time=t.time,this.target=t.target,this.rootBounds=t.rootBounds,this.boundingClientRect=t.boundingClientRect,this.intersectionRect=t.intersectionRect||{top:0,bottom:0,left:0,right:0,width:0,height:0},this.isIntersecting=!!t.intersectionRect;var e=this.boundingClientRect,n=e.width*e.height,i=this.intersectionRect,o=i.width*i.height;this.intersectionRatio=n?o/n:this.isIntersecting?1:0};var e=function(e){function n(t,n){e.call(this),this.registry=[],this.init(t,n),this.options=n||{},this._callback=t,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(this.options.rootMargin),this.thresholds=this._initThresholds(this.options.threshold),this.root=this.options.root||null,this.rootMargin=this._rootMarginValues.map(function(t){return t.value+t.unit}).join(" "),this._checkForIntersections=this.throttle(this._checkForIntersections.bind(this),this.THROTTLE_TIMEOUT)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.init=function(t,e){if("function"!=typeof t)throw new Error("callback must be a function");if(e.root&&1!=e.root.nodeType)throw new Error("root must be an Element")},n.prototype.observe=function(t){if(this._observationTargets.some(function(e){return e.element==t}))return this;if(!t||1!=t.nodeType)throw new Error("target must be an Element");return this._registerInstance(),this._observationTargets.push({element:t,entry:null}),this._monitorIntersections(),this._checkForIntersections(),this},n.prototype._registerInstance=function(){return this.registry.indexOf(this)<0&&this.registry.push(this),this},n.prototype.unobserve=function(t){return this._observationTargets=this._observationTargets.filter(function(e){return e.element!=t}),this._observationTargets.length||(this._unmonitorIntersections(),this._unregisterInstance()),this},n.prototype.disconnect=function(){return this._observationTargets=[],this._unmonitorIntersections(),this._unregisterInstance(),this},n.prototype.takeRecords=function(){var t=this._queuedEntries.slice();return this._queuedEntries=[],t},n.prototype._initThresholds=function(t){var e=t||[0];return Array.isArray(e)||(e=[e]),e.sort().filter(function(t,e,n){if("number"!=typeof t||isNaN(t)||t<0||t>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return t!==n[e-1]})},n.prototype._parseRootMargin=function(t){var e=(t||"0px").split(/\s+/).map(function(t){var e=/^(-?\d*\.?\d+)(px|%)$/.exec(t);if(!e)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(e[1]),unit:e[2]}});return e[1]=e[1]||e[0],e[2]=e[2]||e[0],e[3]=e[3]||e[1],e},n.prototype._monitorIntersections=function(){return this._monitoringIntersections||(this._monitoringIntersections=!0,this.POLL_INTERVAL?this._monitoringInterval=setInterval(this._checkForIntersections,this.POLL_INTERVAL):(this.addEvent(window,"resize",this._checkForIntersections,!0),this.addEvent(document,"scroll",this._checkForIntersections,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in window&&(this._domObserver=new MutationObserver(this._checkForIntersections),this._domObserver.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})))),this},n.prototype._unmonitorIntersections=function(){return this._monitoringIntersections&&(this._monitoringIntersections=!1,clearInterval(this._monitoringInterval),this._monitoringInterval=null,this.removeEvent(window,"resize",this._checkForIntersections,!0),this.removeEvent(document,"scroll",this._checkForIntersections,!0),this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null)),this},n.prototype._checkForIntersections=function(){var e=this,n=this._rootIsInDom(),i=n?this._getRootRect():this.getEmptyRect();this._observationTargets.forEach(function(o){var r=o.element,s=e.getBoundingClientRect(r),c=e._rootContainsTarget(r),h=o.entry,A=n&&c&&e._computeTargetAndRootIntersection(r,i),u=o.entry=new t({time:e.now(),target:r,boundingClientRect:s,rootBounds:i,intersectionRect:A});h?n&&c?e._hasCrossedThreshold(h,u)&&e._queuedEntries.push(u):h&&h.isIntersecting&&e._queuedEntries.push(u):e._queuedEntries.push(u)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)},n.prototype._computeTargetAndRootIntersection=function(t,e){if("none"!=window.getComputedStyle(t).display){for(var n=this.getBoundingClientRect(t),i=this.getParentNode(t),o=!1;!o;){var r=null,s=1==i.nodeType?window.getComputedStyle(i):{};if("none"==s.display)return;if(i==this.root||i==document?(o=!0,r=e):i!=document.body&&i!=document.documentElement&&"visible"!=s.overflow&&(r=this.getBoundingClientRect(i)),r&&!(n=this.computeRectIntersection(r,n)))break;i=this.getParentNode(i)}return n}},n.prototype._getRootRect=function(){var t;if(this.root)t=this.getBoundingClientRect(this.root);else{var e=document.documentElement,n=document.body;t={top:0,left:0,right:e.clientWidth||n.clientWidth,width:e.clientWidth||n.clientWidth,bottom:e.clientHeight||n.clientHeight,height:e.clientHeight||n.clientHeight}}return this._expandRectByRootMargin(t)},n.prototype._expandRectByRootMargin=function(t){var e=this._rootMarginValues.map(function(e,n){return"px"==e.unit?e.value:e.value*(n%2?t.width:t.height)/100}),n={top:t.top-e[0],right:t.right+e[1],bottom:t.bottom+e[2],left:t.left-e[3],width:0,height:0};return n.width=n.right-n.left,n.height=n.bottom-n.top,n},n.prototype._hasCrossedThreshold=function(t,e){var n=t&&t.isIntersecting?t.intersectionRatio||0:-1,i=e.isIntersecting?e.intersectionRatio||0:-1;if(n!==i)for(var o=0;o<this.thresholds.length;o++){var r=this.thresholds[o];if(r==n||r==i||r<n!=r<i)return!0}},n.prototype._rootIsInDom=function(){return!this.root||this.containsDeep(document,this.root)},n.prototype._rootContainsTarget=function(t){return this.containsDeep(this.root||document,t)},n.prototype._unregisterInstance=function(){var t=this.registry.indexOf(this);-1!=t&&this.registry.splice(t,1)},n.prototype.now=function(){return window.performance&&performance.now&&performance.now()},n.prototype.throttle=function(t,e){var n=null;return function(){n||(n=setTimeout(function(){t(),n=null},e))}},n.prototype.addEvent=function(t,e,n,i){"function"==typeof t.addEventListener?t.addEventListener(e,n,i||!1):"function"==typeof t.attachEvent&&t.attachEvent("on"+e,n)},n.prototype.removeEvent=function(t,e,n,i){"function"==typeof t.removeEventListener?t.removeEventListener(e,n,i||!1):"function"==typeof t.detatchEvent&&t.detatchEvent("on"+e,n)},n.prototype.computeRectIntersection=function(t,e){var n=Math.max(t.top,e.top),i=Math.min(t.bottom,e.bottom),o=Math.max(t.left,e.left),r=Math.min(t.right,e.right),s=r-o,c=i-n;return s>=0&&c>=0&&{top:n,bottom:i,left:o,right:r,width:s,height:c}},n.prototype.getBoundingClientRect=function(t){var e;try{e=t.getBoundingClientRect()}catch(t){}return e?(e.width&&e.height||(e={top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.right-e.left,height:e.bottom-e.top}),e):this.getEmptyRect()},n.prototype.getEmptyRect=function(){return{top:0,bottom:0,left:0,right:0,width:0,height:0}},n.prototype.containsDeep=function(t,e){for(var n=e;n;){if(n==t)return!0;n=this.getParentNode(n)}return!1},n.prototype.getParentNode=function(t){var e=t.parentNode;return e&&11==e.nodeType&&e.host?e.host:e},n}(function(){this.THROTTLE_TIMEOUT=100,this.POLL_INTERVAL=null,this.USE_MUTATION_OBSERVER=!0}),n=function(){this.initPolyfill()};n.prototype.initPolyfill=function(){return window&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype&&"isIntersecting"in window.IntersectionObserverEntry.prototype?this:window&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype?("isIntersecting"in window.IntersectionObserverEntry.prototype||this.polyfillIsIntersecting(),this):(this.polyfillAll(),this)},n.prototype.polyfillIsIntersecting=function(){return console.log("无isIntersecting属性，低级兼容模式开启"),Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}}),this},n.prototype.polyfillAll=function(){console.log("当前浏览器不支持IntersectionObserver，高级兼容模式开启"),this.injectWindow()},n.prototype.injectWindow=function(){window.IntersectionObserver=e,window.IntersectionObserverEntry=t};var i=function(t,e){this.options={root:null,rootMargin:"0px",threshold:0},this.intersectionObserver={},this.intersectionOberserPolyfill={},Object.assign(this.options,e),this.createObserver(t)};i.prototype.createObserver=function(t){this.intersectionOberserPolyfill=new n,this.intersectionObserver=new IntersectionObserver(function(e){return t(e)},this.options)},i.prototype.subscribe=function(t){this.intersectionObserver.observe(t)},i.prototype.unSubscribe=function(t){this.intersectionObserver.unobserve(t)},i.prototype.remove=function(){this.intersectionObserver.disconnect(),delete this.intersectionObserver,delete this.intersectionOberserPolyfill};var o,r,s={},c=function(t){t.forEach(function(t,e){if(t.isIntersecting||t.intersectionRatio>o&&o.threshold){var n=t.target.getAttribute("data-lazy");if(t.target.src===n)return;var i="key"+(e+1)+t.intersectionRect.top+"\n\t\t\t\t"+t.intersectionRect.bottom+t.time;s[i]=setTimeout(function(){t.target.src=n,clearTimeout(s[i]),delete s[i]},r||500*Math.random())}})},h=function(t,e,n){this.root={},this.observerInview={},this.saveDomMessage(t,n),this.el=t,this.vnode=e,this.subscribeOberser()};h.prototype.saveDomMessage=function(t,e){return t.setAttribute("data-lazy",t.src),t.src=e||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAIOklEQVR4nO3bW1Pa7B6G8TsJBgS0Cmqxo77ag9IZv2IP1pfsQccZbbHUDRARIhA2yTrQ8Criv5s1S51y/WZ6gBh4aHMlz5NQp9/vJwIwl/vSAwBeMwIBDAQCGAgEMBAIYCAQwEAggIFAAAOBAAYCAQwEAhgIBDAQCGAgEMBAIICBQAADgQAGAgEMBAIYCAQwEAhgIBDAQCCAgUAAA4EABgIBDAQCGAgEMBAIYCAQwEAggIFAAAOBAAYCAQwEAhgIBDAQCGAgEMBAIICBQAADgQAGAgEMBAIYCAQwEAhgIBDAQCCAgUAAA4EABgIBDAQCGAgEMBAIYCAQwEAggIFAAAOBAAYCAQwEAhgIBDAQCGAgEMBAIICBQAADgQAGAgEMBAIYCAQwEAhgIBDAQCCAgUAAA4EABgIBDAQCGAgEMBAIYCAQwEAggIFAAAOBAAYCAQwEAhgIBDAQCGAgEMBAIIAh89IDeE6fP39+8Pjw8PCFRvLY7Nik1zW+RbVQZ5APHz5ofX39pYcx18ePH3VwcKB8Pv/SQ8E9CxXI0tKS3r59+9LDmMvzPOXzeb179878vZOTEx0fHz/TqLBQgUi3O+Jrls1mf/o7juM8w0ggLdga5G9wcHDw0kNYKAt3BgF+B4EABqZYM6IoUrPZVBiGmkwm8jxPhUJBGxsbyuVyc7fp9/sKgkC9Xk+j0UiO4yibzapUKmltbW3uNnEcKwgCXV9fK4oiua4r3/e1srIy9/eHw6Fubm6mf6rV6vS5eZevB4OBGo2Ger2eJpOJlpaWVCqVVC6X577+aDTS5eWlwjDUeDx+8u9n0S49E8g9YRiqVqupUCjon3/+ke/7Go1GOj8/1/HxsXZ2drS6uvpgmyAIdHl5qd3dXVUqFTmOo8FgoLOzM9XrdSVJ8ujSchRFqtVqSpJElUpFxWJRk8lE3W5XFxcXc8d2dHT05Lir1aqazaZarZYkqd1uazgcanNzU77vazAYqF6v6/z8XJ7nPYo2iiKdnJzI8zzt7u4qm82q3++rXq9rPB5rb2/vyXD/dkyx7oxGI52eniqbzWpvb0+5XE6u604fZ7NZff/+XcPh8MF2FxcXSpJEhUJBnufJdV3l83nt7OxI0nSnTcVxrFqtpvF4rP39fa2ursp13ekRfnd3d+74qtWqNjY25j6XyWS0tbX16HH6Ge5fPp4dT/oZJpOJtre3lc/n5XmeisWiKpWKpNuDwKIikDutVktxHKtUKj26jOo4jsrlspIkUbPZfPDc8vKylpeXH71eerl2NqggCDQcDlUul+X7/qPtisXi3PHNRjDLdf/9p5z3GukYZ8cjSTc3N5L06CZloVCQdDuFXFRMse6EYSjp351iVrqDpTtTan9//8HjKIrU7XZ1fX0tSUqS5MHz6c//ZMryv9z/SAOK4/jJ150da/rzedssCs4gd9IjayYz/5ixtLQk6XYqNmswGOj8/FxHR0fTef5TU6X0fX7lhuBzSc846UEilR4MnjqrLQLOIDNmj6Kz7h/F4zhWvV5Xp9PR+vq69vf3pyH96eu/hEqloiiKpnHn83n1+32dnZ0pk8lM1yKLiEDu+L6vKIo0Ho/nfh0lvfR5f91wfn6uTqejra0tbW5u/tb7jEajV3MWyWQyOjg40NevX/Xt2zdJt1/JWVlZ0dbW1k+j/5sRyJ1isagoihSG4dwdN51u3F87dDodSVKpVPrl91lZWVEURer1eq8mEOn2Sla/31e1Wn1ymrmIFnoNcn+6Uy6X5bqugiB4tCiN41jNZlOe5z2IwVrERlE09z3L5bI8z1Oj0dBkMnn0/P2fWdOxP33uKe12W5KmN0hxy/v06dN/XnoQzyWOY11fX6vb7Uq63cHTewWe52l5eVlXV1fq9XrK5XLyPE9RFKler2s4HE7vj6Qmk4l6vZ4Gg8H0dcbjsa6urhSGoeI41mQyUTabVTableM4cl1Xy8vLarfb6nQ68n1fmUxGcRwrDEM1Go3pQt7zPOVyOTmOoziO1el0pmet9G6967rm55r3uT3Pm26bGgwG0ytwzWZTjUZDrVZLQRCo2+3Kdd0nv0nwN3P6/f7rWzX+n8z7X3vSw69PzPuqSbFYnN6Vvi9JEgVBoCAINBqNpjtRqVTS6uqqwjDUjx8/NB6Plcvl9P79++m2w+FQjUZj+j6+72ttbU2lUklfvnx5cFY6PDw0x/6zz/Urn3s8HqvRaJg3Bbe3t39rOvk3WKhA8Fh69Wo4HGpjY0OFQkG+7ytJkukZMAgCtVotZTKZB98BWwQLvQaBdHp6qjAMtbe3p/X19elZ0nEceZ4n3/end/AXcW1CIAsuvfFp3aUfDAaSFvOGIYEsuHRNUavVdH19rdFoNJ1epeuxWq2mXC6n7e3tFx7t82MNAnU6HbXbbQ0GA43HYyVJIsdxlMlklMvl9ObNG62uri7k/4UnEMDAFAswEAhgIBDAQCCAgUAAA4EABgIBDAQCGAgEMBAIYCAQwEAggIFAAAOBAAYCAQwEAhgIBDAQCGAgEMBAIICBQAADgQAGAgEMBAIYCAQwEAhgIBDAQCCAgUAAA4EABgIBDAQCGAgEMBAIYCAQwEAggIFAAAOBAAYCAQwEAhgIBDAQCGAgEMBAIICBQAADgQAGAgEMBAIYCAQwEAhgIBDAQCCAgUAAA4EABgIBDAQCGAgEMBAIYCAQwEAggIFAAAOBAAYCAQwEAhgIBDAQCGAgEMBAIICBQAADgQAGAgEMBAIYCAQwEAhgIBDAQCCAgUAAA4EABgIBDAQCGAgEMBAIYCAQwEAggIFAAAOBAAYCAQz/BYmt0h2CbgtDAAAAAElFTkSuQmCC",this},h.prototype.subscribeOberser=function(){if(!this.vnode.context||!this.vnode.context.$root)return this;this.root=this.vnode.context.$root;return Object.assign({},o,{root:this.vnode.context.$root.$el}),this.root.$ObserverInview||(this.root.$ObserverInview=new i(c,o)),this.root.$ObserverInview.subscribe(this.el),this.observerInview=this.root.$ObserverInview,this},h.prototype.destroy=function(){return this.observerInview.unSubscribe(this.el),this};var A={inserted:function(t,e,n){if(/.(jpg|gif|png|jepg)/g.test(t.src)){if("img"!==t.tagName.toLocaleLowerCase())throw new Error("this dom is not img");!function(t,e,n){if(!t.oberserDom){var i=e.value&&e.value.url||"";t.oberserDom=new h(t,n,i)}}(t,e,n)}else console.warn("this src is not img address")},unbind:function(t){t.oberserDom&&(t.oberserDom.destroy(),delete t.oberserDom)}};export default{install:function(t,e){o=e&&e.observerOptions,r=e&&e.delayTime,t.directive("img-lazy-load",A)}};export{A as directive};
